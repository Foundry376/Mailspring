{"version":3,"sources":["../src/pubsub.js"],"names":[],"mappings":"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","file":"pubsub.js","sourcesContent":["import { Namespace as NS } from 'xmpp-constants';\n\n\nexport default function (JXT) {\n\n    let Utils = JXT.utils;\n\n\n    let Pubsub = JXT.define({\n        name: 'pubsub',\n        namespace: NS.PUBSUB,\n        element: 'pubsub',\n        fields: {\n            create: {\n                get: function () {\n\n                    let node = Utils.getSubAttribute(this.xml, NS.PUBSUB, 'create', 'node');\n                    if (node) {\n                        return node;\n                    }\n                    return Utils.getBoolSub(this.xml, NS.PUBSUB, 'create');\n                },\n                set: function (value) {\n\n                    if (value === true || !value) {\n                        Utils.setBoolSub(this.xml, NS.PUBSUB, 'create', value);\n                    } else {\n                        Utils.setSubAttribute(this.xml, NS.PUBSUB, 'create', 'node', value);\n                    }\n                }\n            },\n            publishOptions: {\n                get: function () {\n\n                    let DataForm = JXT.getDefinition('x', NS.DATAFORM);\n                    let conf = Utils.find(this.xml, NS.PUBSUB, 'publish-options');\n                    if (conf.length && conf[0].childNodes.length) {\n                        return new DataForm({}, conf[0].childNodes[0]);\n                    }\n                },\n                set: function (value) {\n\n                    let DataForm = JXT.getDefinition('x', NS.DATAFORM);\n                    let conf = Utils.findOrCreate(this.xml, NS.PUBSUB, 'publish-options');\n                    if (value) {\n                        let form = new DataForm(value);\n                        conf.appendChild(form.xml);\n                    }\n                }\n            }\n        }\n    });\n\n    let Configure = JXT.define({\n        name: 'config',\n        namespace: NS.PUBSUB,\n        element: 'configure'\n    });\n\n    let Subscribe = JXT.define({\n        name: 'subscribe',\n        namespace: NS.PUBSUB,\n        element: 'subscribe',\n        fields: {\n            node: Utils.attribute('node'),\n            jid: Utils.jidAttribute('jid')\n        }\n    });\n\n    let Subscription = JXT.define({\n        name: 'subscription',\n        namespace: NS.PUBSUB,\n        element: 'subscription',\n        fields: {\n            node: Utils.attribute('node'),\n            jid: Utils.jidAttribute('jid'),\n            subid: Utils.attribute('subid'),\n            type: Utils.attribute('subscription'),\n            configurable: Utils.boolSub('subscribe-options'),\n            configurationRequired: {\n                get: function () {\n\n                    let options = Utils.find(this.xml, NS.PUBSUB, 'subscribe-options');\n                    if (options.length) {\n                        return Utils.getBoolSub(options[0], NS.PUBSUB, 'required');\n                    }\n                    return false;\n                }\n            }\n        }\n    });\n\n    let Subscriptions = JXT.define({\n        name: 'subscriptions',\n        namespace: NS.PUBSUB,\n        element: 'subscriptions',\n        fields: {\n            node: Utils.attribute('node'),\n            jid: Utils.jidAttribute('jid')\n        }\n    });\n\n    let Affiliation = JXT.define({\n        name: 'affiliation',\n        namespace: NS.PUBSUB,\n        element: 'affiliation',\n        fields: {\n            node: Utils.attribute('node'),\n            type: Utils.attribute('affiliation')\n        }\n    });\n\n    let Affiliations = JXT.define({\n        name: 'affiliations',\n        namespace: NS.PUBSUB,\n        element: 'affiliations',\n        fields: {\n            node: Utils.attribute('node')\n        }\n    });\n\n    let SubscriptionOptions = JXT.define({\n        name: 'subscriptionOptions',\n        namespace: NS.PUBSUB,\n        element: 'options',\n        fields: {\n            node: Utils.attribute('node'),\n            jid: Utils.jidAttribute('jid'),\n            subid: Utils.attribute('subid')\n        }\n    });\n\n    let Unsubscribe = JXT.define({\n        name: 'unsubscribe',\n        namespace: NS.PUBSUB,\n        element: 'unsubscribe',\n        fields: {\n            node: Utils.attribute('node'),\n            subid: Utils.attribute('subid'),\n            jid: Utils.jidAttribute('jid')\n        }\n    });\n\n    let Publish = JXT.define({\n        name: 'publish',\n        namespace: NS.PUBSUB,\n        element: 'publish',\n        fields: {\n            node: Utils.attribute('node')\n        }\n    });\n\n    let Retract = JXT.define({\n        name: 'retract',\n        namespace: NS.PUBSUB,\n        element: 'retract',\n        fields: {\n            node: Utils.attribute('node'),\n            notify: Utils.boolAttribute('notify'),\n            id: Utils.subAttribute(NS.PUBSUB, 'item', 'id')\n        }\n    });\n\n    let Retrieve = JXT.define({\n        name: 'retrieve',\n        namespace: NS.PUBSUB,\n        element: 'items',\n        fields: {\n            node: Utils.attribute('node'),\n            max: Utils.attribute('max_items')\n        }\n    });\n\n    let Item = JXT.define({\n        name: 'item',\n        namespace: NS.PUBSUB,\n        element: 'item',\n        fields: {\n            id: Utils.attribute('id'),\n            publisher: Utils.jidAttribute('publisher')\n        }\n    });\n\n\n    JXT.extend(Pubsub, Configure);\n    JXT.extend(Pubsub, Subscribe);\n    JXT.extend(Pubsub, Unsubscribe);\n    JXT.extend(Pubsub, Publish);\n    JXT.extend(Pubsub, Retract);\n    JXT.extend(Pubsub, Retrieve);\n    JXT.extend(Pubsub, Subscription);\n    JXT.extend(Pubsub, SubscriptionOptions);\n    JXT.extend(Pubsub, Subscriptions);\n    JXT.extend(Pubsub, Affiliations);\n\n    JXT.extend(Publish, Item, 'items');\n    JXT.extend(Retrieve, Item, 'items');\n\n    JXT.extend(Subscriptions, Subscription, 'list');\n    JXT.extend(Affiliations, Affiliation, 'list');\n\n    JXT.extendIQ(Pubsub);\n\n    JXT.withDataForm(function (DataForm) {\n\n        JXT.extend(SubscriptionOptions, DataForm);\n        JXT.extend(Item, DataForm);\n        JXT.extend(Configure, DataForm);\n    });\n\n    JXT.withDefinition('set', NS.RSM, function (RSM) {\n\n        JXT.extend(Pubsub, RSM);\n    });\n}\n"]}