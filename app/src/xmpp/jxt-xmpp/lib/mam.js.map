{"version":3,"sources":["../src/mam.js"],"names":[],"mappings":"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","file":"mam.js","sourcesContent":["import { Namespace as NS } from 'xmpp-constants';\nimport { JID } from 'xmpp-jid';\n\n\nexport default function (JXT) {\n\n    let Utils = JXT.utils;\n\n    let MAMQuery = JXT.define({\n        name: 'mam',\n        namespace: NS.MAM_2,\n        element: 'query',\n        fields: {\n            queryid: Utils.attribute('queryid'),\n            node: Utils.attribute('node')\n        }\n    });\n\n    let Result = JXT.define({\n        name: 'mamItem',\n        namespace: NS.MAM_2,\n        element: 'result',\n        fields: {\n            queryid: Utils.attribute('queryid'),\n            id: Utils.attribute('id')\n        }\n    });\n\n    let Fin = JXT.define({\n        name: 'mamResult',\n        namespace: NS.MAM_2,\n        element: 'fin',\n        fields: {\n            complete: Utils.boolAttribute('complete'),\n            stable: Utils.boolAttribute('stable')\n        }\n    });\n\n    let Prefs = JXT.define({\n        name: 'mamPrefs',\n        namespace: NS.MAM_2,\n        element: 'prefs',\n        fields: {\n            defaultCondition: Utils.attribute('default'),\n            always: {\n                get: function () {\n\n                    let results = [];\n                    let container = Utils.find(this.xml, NS.MAM_2, 'always');\n                    if (container.length === 0) {\n                        return results;\n                    }\n                    container = container[0];\n                    let jids = Utils.getMultiSubText(container, NS.MAM_2, 'jid');\n                    jids.forEach(function (jid) {\n\n                        results.push(new JID(jid.textContent));\n                    });\n                    return results;\n                },\n                set: function (value) {\n\n                    if (value.length > 0) {\n                        let container = Utils.findOrCreate(this.xml, NS.MAM_2, 'always');\n                        Utils.setMultiSubText(container, NS.MAM_2, 'jid', value);\n                    }\n                }\n            },\n            never: {\n                get: function () {\n\n                    let results = [];\n                    let container = Utils.find(this.xml, NS.MAM_2, 'always');\n                    if (container.length === 0) {\n                        return results;\n                    }\n                    container = container[0];\n                    let jids = Utils.getMultiSubText(container, NS.MAM_2, 'jid');\n                    jids.forEach(function (jid) {\n\n                        results.push(new JID(jid.textContent));\n                    });\n                    return results;\n                },\n                set: function (value) {\n\n                    if (value.length > 0) {\n                        let container = Utils.findOrCreate(this.xml, NS.MAM_2, 'never');\n                        Utils.setMultiSubText(container, NS.MAM_2, 'jid', value);\n                    }\n                }\n            }\n        }\n    });\n\n\n    JXT.extendMessage(Result);\n\n    JXT.extendIQ(MAMQuery);\n    JXT.extendIQ(Prefs);\n    JXT.extendIQ(Fin);\n\n    JXT.withDataForm(function (DataForm) {\n\n        JXT.extend(MAMQuery, DataForm);\n    });\n\n    JXT.withDefinition('forwarded', NS.FORWARD_0, function (Forwarded) {\n\n        JXT.extend(Result, Forwarded);\n    });\n\n    JXT.withDefinition('set', NS.RSM, function (RSM) {\n\n        JXT.extend(MAMQuery, RSM);\n        JXT.extend(Fin, RSM);\n    });\n}\n"]}